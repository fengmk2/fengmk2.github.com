<!DOCTYPE html>
<!--[if lt IE 7]> <html class="no-js ie6" lang="en"> <![endif]-->
<!--[if IE 7]>    <html class="no-js ie7" lang="en"> <![endif]-->
<!--[if IE 8]>    <html class="no-js ie8" lang="en"> <![endif]-->
<!--[if gt IE 8]><!-->  <html class="no-js" lang="en"> <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  
  <title> Nodejs 快速开发Web产品 </title>
  
  <meta name="description" content="A jQuery library for modern HTML presentations">
  <meta name="author" content="Caleb Troughton">
  <meta name="viewport" content="width=1024, user-scalable=no">
  
  <!-- Core and extension CSS files -->
  <link rel="stylesheet" href="./deck.js/core/deck.core.css">
  <link rel="stylesheet" href="./deck.js/extensions/goto/deck.goto.css">
  <link rel="stylesheet" href="./deck.js/extensions/menu/deck.menu.css">
  <link rel="stylesheet" href="./deck.js/extensions/navigation/deck.navigation.css">
  <link rel="stylesheet" href="./deck.js/extensions/status/deck.status.css">
  <link rel="stylesheet" href="./deck.js/extensions/hash/deck.hash.css">
  <link rel="stylesheet" href="./style.css">
  
  <!-- Theme CSS files (menu swaps these out) -->
  <link rel="stylesheet" id="style-theme-link" href="./deck.js/themes/style/neon.css">
  <link rel="stylesheet" id="transition-theme-link" href="./deck.js/themes/transition/horizontal-slide.css">
  
  <link rel="stylesheet" href="http://fengmk2.github.com/css/prettify.css" />
  <script src="http://fengmk2.github.com/js/jquery-1.7.min.js"></script>
  <script src="http://fengmk2.github.com/js/prettify.js"></script>

  <script src="./deck.js/modernizr.custom.js"></script>
</head>

<body class="deck-container">


<section class="slide"><h1>Nodejs 快速开发Web产品</h1>
</section>

<section class="slide"><h2>Who am I?我是谁？</h2>
<h3>Alibaba Data EDP</h3>
<h3>阿里巴巴数据平台EDP，花名@苏千</h3>
<h3>Chinese nodejs community: <a href="http://cnodejs.org">cnodejs.org</a></h3>
<hr/>

<h3>Github: @<a href="https://github.com/fengmk2/">fengmk2</a></h3>
<h3>Blog: <a href="http://fengmk2.github.com">http://fengmk2.github.com</a></h3>
<h3>Twitter: @fengmk2</h3>
<h3>Weibo: @Python发烧友 , @FaWave</h3>
</section>

<section class="slide"><h1>什么是Web开发</h1>
</section>

<section class="slide"><h2>Web开发</h2>
<ul>
<li>HTTP</li>
<li>Request</li>
<li>Response</li>
<li>Cookie</li>
<li>Session</li>
<li>URL routing</li>
<li>Template Engine</li>
<li>DataBase</li>
</ul>
</section>

<section class="slide"><h1>Why Nodejs?</h1>
</section>

<section class="slide"><h2>IO密集型</h2>
<h3>* 磁盘IO：读写文件</h3>
<h3>* 网络IO：数据库，Cache，Services</h3>
<h3>* 进程：进程通信，进程调用</h3>
</section>

<section class="slide"><h2>Nodejs的核心关键词</h2>
<p><img src="http://nfs.nodeblog.org/a/e/ae78a26d6c26b7ab755f1c34da778196.png" alt="about nodejs">

</p>
<h3>* V8</h3>
<h3>* Event driven</h3>
<h3>* Non-blocking IO</h3>
</section>

<section class="slide"><h2>V8有多快？</h2>
<p><img src="http://nfs.nodeblog.org/e/c/eca1b2026c120772533318553454c7c6.png" alt="fibonacci">

</p>
<ul>
<li><a href="http://fengmk2.github.com/blog/2011/fibonacci/nodejs-python-php-ruby-lua.html">fibonacci(40) benchmark</a></li>
</ul>
</section>

<section class="slide"><h2>高楼平地起: Hello World</h2>
<p><a href="https://github.com/fengmk2/nodejs-web-dev/blob/master/helloworld.js">helloworld.js</a>
</p>
<pre><code class="lang-js">var http = require(&#39;http&#39;);
http.createServer(function (req, res) {
  console.log(&#39;%s %s : %j&#39;, req.method, req.url, req.headers);
  req.on(&#39;end&#39;, function () {
    res.writeHeader(200, { &#39;Content-Type&#39;: &#39;text/html&#39; });
    res.end(&#39;Hello QCon Hangzhou&#39;);
  });
}).listen(1984);</code></pre>
<hr/>

<h3>Event driven: req.<code>on</code>(<code>&#39;end&#39;</code>, function () {})</h3>
</section>

<section class="slide"><h2>看看得到什么</h2>
<p><img src="http://ww1.sinaimg.cn/large/6cfc7910jw1dy32hus4ipj.jpg" alt="hello world result">

</p>
</section>

<section class="slide"><h2>console.log()</h2>
<pre><code class="lang-bash">$ node helloworld.js 

GET / : {&quot;host&quot;:&quot;localhost.cnodejs.org:1984&quot;,&quot;connection&quot;:&quot;keep-alive&quot;,&quot;cache-control&quot;:&quot;max-age=0&quot;,&quot;user-agent&quot;:&quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_8_2) AppleWebKit/537.4 (KHTML, like Gecko) Chrome/22.0.1229.79 Safari/537.4&quot;,&quot;accept&quot;:&quot;text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8&quot;,&quot;accept-encoding&quot;:&quot;gzip,deflate,sdch&quot;,&quot;accept-language&quot;:&quot;zh-CN,zh;q=0.8,en;q=0.6,en-US;q=0.4&quot;,&quot;accept-charset&quot;:&quot;GBK,utf-8;q=0.7,*;q=0.3&quot;}

GET /favicon.ico : {&quot;host&quot;:&quot;localhost.cnodejs.org:1984&quot;,&quot;connection&quot;:&quot;keep-alive&quot;,&quot;accept&quot;:&quot;*/*&quot;,&quot;user-agent&quot;:&quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_8_2) AppleWebKit/537.4 (KHTML, like Gecko) Chrome/22.0.1229.79 Safari/537.4&quot;,&quot;accept-encoding&quot;:&quot;gzip,deflate,sdch&quot;,&quot;accept-language&quot;:&quot;zh-CN,zh;q=0.8,en;q=0.6,en-US;q=0.4&quot;,&quot;accept-charset&quot;:&quot;GBK,utf-8;q=0.7,*;q=0.3&quot;}</code></pre>
</section>

<section class="slide"><h1>说笑吧，太简单了吧</h1>
</section>

<section class="slide"><h2>Simple todo</h2>
<p>使用 <code>Mongodb</code> 存储，快速实现最简单的两个功能:

</p>
<h3>* 添加任务</h3>
<h3>* 显示任务</h3>
<h3>* 完成任务</h3>
</section>

<section class="slide"><h2>目录结构</h2>
<pre><code>|- app.js
|- config.js
|- routes.js
|- package.json
|- views/
 |- layout.html
 |- index.html
|- public/
 |- images/
 |- styles/
|- controllers/
 |- home.js
 |- task.js
|- models/
 |- db.js
 |- task.js
|- node_modules/</code></pre>
</section>

<section class="slide"><h2>package.json</h2>
<h3>使用npm init 生成项目的 package.json</h3>
<pre><code class="lang-bash">$ npm init</code></pre>
<h2>使用强大的第三方模块加速开发效率</h2>
<h3>依赖模块:</h3>
<pre><code class="lang-json">  &quot;dependencies&quot;: {
    &quot;connect&quot;: &quot;2.6.0&quot;, // web server, static files hosting
    &quot;urlrouter&quot;: &quot;0.2.3&quot;, // url routing
    &quot;connect-render&quot;: &quot;0.1.7&quot;, // ejs template engine helper
    &quot;mongoskin&quot;: &quot;0.4.4&quot; // mongodb client
  }</code></pre>
</section>

<section class="slide"><h2>主页面效果</h2>
<h3>HTML + CSS，服务器端使用 <a href="https://github.com/visionmedia/ejs">ejs</a> 模板引擎渲染</h3>
<p><img src="http://ww4.sinaimg.cn/large/6cfc7910jw1dy3aj29sgyj.jpg" alt="index page">

</p>
</section>

<section class="slide"><h2>主页面 URL Routing</h2>
<h3>URL路由简单明了</h3>
<pre><code class="lang-js">var home = require(&#39;./controllers/home&#39;);
// HTTP GET / =&gt; home controller
app.get(&#39;/&#39;, home);</code></pre>
</section>

<section class="slide"><h2>Home Controller</h2>
<pre><code class="lang-js">module.exports = function home(req, res, next) {
  res.render(&#39;index.html&#39;, {
    tasks: [] // 稍后会增加数据库逻辑
  });
};</code></pre>
</section>

<section class="slide"><h2><code>index.html</code> 模板</h2>
<pre><code class="lang-html">&lt;div class=&quot;box todos&quot;&gt;
  &lt;h2 class=&quot;box&quot;&gt;待办事项&lt;/h2&gt;
  &lt;ul&gt;
    &lt;% for (var i = 0; i &lt; tasks.length; i++) {
      var task = tasks[i];
      var classname = task.finished ? &#39;class=&quot;finished&quot;&#39; : &#39;&#39;;
    %&gt;
      &lt;li &lt;%- classname %&gt;&gt;
        &lt;% if (!task.finished) { %&gt;
          &lt;%= task.title %&gt;
          &amp;nbsp;
          &lt;a href=&quot;/task/&lt;%- task._id %&gt;/finish&quot;&gt;完成&lt;/a&gt;
        &lt;% } else { %&gt;
          &lt;del&gt;&lt;%= task.title %&gt;&lt;/del&gt;
          &amp;nbsp;
          &lt;a href=&quot;/task/&lt;%- task._id %&gt;/unfinish&quot;&gt;恢复&lt;/a&gt;
        &lt;% } %&gt;
      &lt;/li&gt;
    &lt;% } %&gt;
  &lt;/ul&gt;
&lt;/div&gt;</code></pre>
</section>

<section class="slide"><h2>静态文件服务</h2>
<h3>直接使用 <a href="https://github.com/senchalabs/connect">connect</a> 的 static 中间件模块</h3>
<pre><code class="lang-js">app.use(&#39;/public&#39;, 
  connect.static(path.join(__dirname, &#39;public&#39;)));</code></pre>
<h3>CSS，图片，客户端脚本</h3>
<pre><code class="lang-html">&lt;link href=&quot;/public/styles/reset.css&quot; rel=&quot;stylesheet&quot; type=&quot;text/css&quot; /&gt;
&lt;link href=&quot;/public/styles/index/style.css&quot; rel=&quot;stylesheet&quot; type=&quot;text/css&quot; /&gt;</code></pre>
</section>

<section class="slide"><h2>添加任务</h2>
<h3>URL路由配置</h3>
<pre><code class="lang-js">var task = require(&#39;./controllers/task&#39;);

app.post(&#39;/task&#39;, task.add);</code></pre>
<h3>HTML模板及CSRF保护</h3>
<pre><code class="lang-html">  &lt;div class=&quot;box post&quot;&gt;
    &lt;h2&gt;新增&lt;/h2&gt;
    &lt;form action=&quot;/task&quot; method=&quot;post&quot; id=&quot;post_new&quot;&gt;
      &lt;input type=&quot;hidden&quot; name=&quot;_csrf&quot; value=&quot;&lt;%- _csrf %&gt;&quot; /&gt;
      &lt;p&gt;&lt;input type=&quot;text&quot; name=&quot;title&quot; class=&quot;long_txt&quot; /&gt;&lt;/p&gt;
      &lt;p&gt;&lt;input type=&quot;submit&quot; class=&quot;submit&quot; value=&quot;添加&quot; /&gt;&lt;/p&gt;
    &lt;/form&gt;
  &lt;/div&gt;</code></pre>
</section>

<section class="slide"><h2>添加任务 controller 实现代码</h2>
<pre><code class="lang-js">var Task = require(&#39;../models&#39;).Task;

exports.add = function (req, res, next) {
  var title = req.body.title;
  var task = {
    title: title, 
    finished: 0, 
    created_at: new Date()
  };
  Task.insert(task, function (err, item) {
    if (err) {
      return next(err);
    }
    res.writeHeader(302, {
      Location: &#39;/&#39;
    });
    res.end();
  });
};</code></pre>
</section>

<section class="slide"><h2>在主页面上显示刚才添加的任务</h2>
<pre><code class="lang-js">var Task = require(&#39;../models&#39;).Task;

module.exports = function home(req, res, next) {
  // 按未完成的排前面，然后再按时间倒序显示
  var options = { 
    sort: [ [ &#39;finished&#39;, &#39;asc&#39; ], [ &#39;_id&#39;, &#39;desc&#39; ] ] 
  };
  Task.findItems({}, options, function (err, tasks) {
    if (err) {
      return next(err);
    }
    res.render(&#39;index.html&#39;, {
      tasks: tasks
    });
  });
};</code></pre>
</section>

<section class="slide"><h2>添加任务效果</h2>
<p><img src="http://ww1.sinaimg.cn/large/6cfc7910jw1dy3drrvbboj.jpg" alt="add task">

</p>
</section>

<section class="slide"><h2>完成任务</h2>
<h3>URL Routing</h3>
<pre><code class="lang-js">// GET /task/50843cf924438a2dfa000001/finish
app.get(&#39;/task/(:id)/finish&#39;, task.finish);</code></pre>
<h3>controller 实现代码</h3>
<pre><code class="lang-js">exports.finish = function (req, res, next) {
  var tid = req.params.id; // mapping from url
  var task = { finished: 1, updated_at: new Date() };
  Task.updateById(tid, { $set: task }, function (err, item) {
    if (err) {
      return next(err);
    }
    res.writeHeader(302, {
      Location: &#39;/&#39;
    });
    res.end();
  });
};</code></pre>
</section>

<section class="slide"><h2>整体效果</h2>
<p><img src="http://ww3.sinaimg.cn/large/6cfc7910jw1dy3cyzeczlj.jpg" alt="todo2">

</p>
</section>

<section class="slide"><h2>Talk is cheap</h2>
<h3>删除任务，编辑任务，用户系统...，剩余的功能，等你来完成。</h3>
<h2>“自己动手，丰衣足食”</h2>
<h3>fork <a href="https://github.com/fengmk2/nodejs-web-dev/tree/master/todo">github.com/fengmk2/nodejs-web-dev</a>, then do it.</h3>
</section>

<section class="slide"><h1>应用展示</h1>
</section>

<section class="slide"><h2>淘宝指数</h2>
<p><img src="http://ww1.sinaimg.cn/large/6cfc7910jw1dy3d4ac0kpj.jpg" alt="shu">

</p>
</section>

<section class="slide"><h2>数据魔方</h2>
<p><img src="http://ww1.sinaimg.cn/large/6cfc7910jw1dy3d6a73rfj.jpg" alt="mofang">

</p>
</section>

<section class="slide"><h2>内部NPM Web</h2>
<p><img src="http://ww4.sinaimg.cn/large/6cfc7910jw1dy3v4d0zs1j.jpg" alt="npmweb">

</p>
</section>

<section class="slide"><h2>CNodejs 社区</h2>
<p><img src="http://ww3.sinaimg.cn/large/6cfc7910jw1dy3d9uzu1yj.jpg" alt="cnode">

</p>
</section>

<section class="slide"><p><a href="http://fengmk2.github.com/ppt/nodejs-web-dev.html"><a href="http://fengmk2.github.com/ppt/nodejs-web-dev.html">http://fengmk2.github.com/ppt/nodejs-web-dev.html</a></a>

</p>
<h1>web.emit(<code>&#39;Thanks&#39;</code>) <br/>&amp;&amp;<br/> console.log(<code>&#39;end&#39;</code>);</h1>
</section>


<p class="deck-status">
  <span class="deck-status-current"></span>
  /
  <span class="deck-status-total"></span>
</p>

<form action="." method="get" class="goto-form">
  <label for="goto-slide">Go to slide:</label>
  <input type="text" name="slidenum" id="goto-slide" list="goto-datalist">
  <datalist id="goto-datalist"></datalist>
  <input type="submit" value="Go">
</form>

<a href="." title="Permalink to this slide" class="deck-permalink">#</a>

<!-- Deck Core and extensions -->
<script src="./deck.js/core/deck.core.js"></script>
<script src="./deck.js/extensions/hash/deck.hash.js"></script>
<script src="./deck.js/extensions/menu/deck.menu.js"></script>
<script src="./deck.js/extensions/goto/deck.goto.js"></script>
<script src="./deck.js/extensions/status/deck.status.js"></script>
<script src="./deck.js/extensions/navigation/deck.navigation.js"></script>

<!-- Specific to this page -->
<script>
$(function() {
  // Deck initialization
  $.deck('.slide');
  $('pre code').parent().addClass('prettyprint');
  prettyPrint();
});
</script>

</body>
</html>
